


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > FileSourceGraphML</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.graphstream.stream.file</a>
</div>

<h1>Coverage Summary for Class: FileSourceGraphML (org.graphstream.stream.file)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">FileSourceGraphML</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/7)
  </span>
</td>
</tr>
  <tr>
    <td class="name">FileSourceGraphML$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/10)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$Balise</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$Data</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$DataAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$EdgeAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$EndPoint</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/6)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$EndPointAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$EndPointType</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$GraphAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$HyperEdgeAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$Key</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$KeyAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$KeyAttrType</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$KeyDomain</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$Locator</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$LocatorAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$NodeAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$Port</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/5)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLConstants$PortAttribute</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">FileSourceGraphML$GraphMLParser</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/16)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/429)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/43)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/504)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;/*
&nbsp; * This file is part of GraphStream &lt;http://graphstream-project.org&gt;.
&nbsp; * 
&nbsp; * GraphStream is a library whose purpose is to handle static or dynamic
&nbsp; * graph, create them from scratch, file or any source and display them.
&nbsp; * 
&nbsp; * This program is free software distributed under the terms of two licenses, the
&nbsp; * CeCILL-C license that fits European law, and the GNU Lesser General Public
&nbsp; * License. You can  use, modify and/ or redistribute the software under the terms
&nbsp; * of the CeCILL-C license as circulated by CEA, CNRS and INRIA at the following
&nbsp; * URL &lt;http://www.cecill.info&gt; or under the terms of the GNU LGPL as published by
&nbsp; * the Free Software Foundation, either version 3 of the License, or (at your
&nbsp; * option) any later version.
&nbsp; * 
&nbsp; * This program is distributed in the hope that it will be useful, but WITHOUT ANY
&nbsp; * WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
&nbsp; * PARTICULAR PURPOSE.  See the GNU Lesser General Public License for more details.
&nbsp; * 
&nbsp; * You should have received a copy of the GNU Lesser General Public License
&nbsp; * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
&nbsp; * 
&nbsp; * The fact that you are presently reading this means that you have had
&nbsp; * knowledge of the CeCILL-C and LGPL licenses and that you accept their terms.
&nbsp; */
&nbsp;
&nbsp;/**
&nbsp; * @since 2011-07-22
&nbsp; * 
&nbsp; * @author Guilhelm Savin &lt;guilhelm.savin@graphstream-project.org&gt;
&nbsp; * @author Hans Schulz &lt;hans.schulz@sap.com&gt;
&nbsp; * @author Hicham Brahimi &lt;hicham.brahimi@graphstream-project.org&gt;
&nbsp; */
&nbsp;package org.graphstream.stream.file;
&nbsp;
&nbsp;import java.io.FileReader;
&nbsp;import java.io.IOException;
&nbsp;import java.io.InputStream;
&nbsp;import java.io.InputStreamReader;
&nbsp;import java.io.Reader;
&nbsp;import java.net.URL;
&nbsp;import java.util.HashMap;
&nbsp;import java.util.HashSet;
&nbsp;import java.util.Iterator;
&nbsp;import java.util.LinkedList;
&nbsp;import java.util.Stack;
&nbsp;import java.util.logging.Logger;
&nbsp;
&nbsp;import javax.xml.stream.FactoryConfigurationError;
&nbsp;import javax.xml.stream.Location;
&nbsp;import javax.xml.stream.XMLEventReader;
&nbsp;import javax.xml.stream.XMLInputFactory;
&nbsp;import javax.xml.stream.XMLStreamConstants;
&nbsp;import javax.xml.stream.XMLStreamException;
&nbsp;import javax.xml.stream.events.Attribute;
&nbsp;import javax.xml.stream.events.XMLEvent;
&nbsp;
&nbsp;import org.graphstream.stream.SourceBase;
&nbsp;
&nbsp;/**
&nbsp; * GraphML is a comprehensive and easy-to-use file format for graphs. It
&nbsp; * consists of a language core to describe the structural properties of a graph
&nbsp; * and a flexible extension mechanism to add application-specific data. Its main
&nbsp; * features include support of
&nbsp; * &lt;ul&gt;
&nbsp; * &lt;li&gt;directed, undirected, and mixed graphs,&lt;/li&gt;
&nbsp; * &lt;li&gt;hypergraphs,&lt;/li&gt;
&nbsp; * &lt;li&gt;hierarchical graphs,&lt;/li&gt;
&nbsp; * &lt;li&gt;graphical representations,&lt;/li&gt;
&nbsp; * &lt;li&gt;references to external data,&lt;/li&gt;
&nbsp; * &lt;li&gt;application-specific attribute data, and&lt;/li&gt;
&nbsp; * &lt;li&gt;light-weight parsers.&lt;/li&gt;
&nbsp; * &lt;/ul&gt;
&nbsp; * &lt;p/&gt;
&nbsp; * Unlike many other file formats for graphs, GraphML does not use a custom
&nbsp; * syntax. Instead, it is based on XML and hence ideally suited as a common
&nbsp; * denominator for all kinds of services generating, archiving, or processing
&nbsp; * graphs.
&nbsp; * &lt;p/&gt;
&nbsp; * &lt;a href=&quot;http://graphml.graphdrawing.org/index.html&quot;&gt;Source&lt;/a&gt;
&nbsp; */
<b class="nc">&nbsp;public class FileSourceGraphML extends FileSourceXML {</b>
<b class="nc">&nbsp;	private static final Logger LOGGER = Logger.getLogger(FileSourceGraphML.class.getName());</b>
&nbsp;
&nbsp;	public interface GraphMLConstants {
<b class="nc">&nbsp;		enum Balise {</b>
<b class="nc">&nbsp;			GRAPHML, GRAPH, NODE, EDGE, HYPEREDGE, DESC, DATA, LOCATOR, PORT, KEY, DEFAULT</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum GraphAttribute {</b>
<b class="nc">&nbsp;			ID, EDGEDEFAULT</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum LocatorAttribute {</b>
<b class="nc">&nbsp;			XMLNS_XLINK, XLINK_HREF, XLINK_TYPE</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum NodeAttribute {</b>
<b class="nc">&nbsp;			ID</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum EdgeAttribute {</b>
<b class="nc">&nbsp;			ID, SOURCE, SOURCEPORT, TARGET, TARGETPORT, DIRECTED</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum DataAttribute {</b>
<b class="nc">&nbsp;			KEY, ID</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum PortAttribute {</b>
<b class="nc">&nbsp;			NAME</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum EndPointAttribute {</b>
<b class="nc">&nbsp;			ID, NODE, PORT, TYPE</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum EndPointType {</b>
<b class="nc">&nbsp;			IN, OUT, UNDIR</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum HyperEdgeAttribute {</b>
<b class="nc">&nbsp;			ID</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum KeyAttribute {</b>
<b class="nc">&nbsp;			ID, FOR, ATTR_NAME, ATTR_TYPE</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum KeyDomain {</b>
<b class="nc">&nbsp;			GRAPHML, GRAPH, NODE, EDGE, HYPEREDGE, PORT, ENDPOINT, ALL</b>
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		enum KeyAttrType {</b>
<b class="nc">&nbsp;			BOOLEAN, INT, LONG, FLOAT, DOUBLE, STRING</b>
&nbsp;		}
&nbsp;
&nbsp;		class Key {
&nbsp;			KeyDomain domain;
&nbsp;			String name;
&nbsp;			KeyAttrType type;
<b class="nc">&nbsp;			String def = null;</b>
&nbsp;
<b class="nc">&nbsp;			Key() {</b>
<b class="nc">&nbsp;				domain = KeyDomain.ALL;</b>
<b class="nc">&nbsp;				name = null;</b>
<b class="nc">&nbsp;				type = KeyAttrType.STRING;</b>
&nbsp;			}
&nbsp;
&nbsp;			Object getKeyValue(String value) {
<b class="nc">&nbsp;				if (value == null)</b>
<b class="nc">&nbsp;					return null;</b>
&nbsp;
<b class="nc">&nbsp;				switch (type) {</b>
&nbsp;				case STRING:
<b class="nc">&nbsp;					return value;</b>
&nbsp;				case INT:
<b class="nc">&nbsp;					return Integer.valueOf(value);</b>
&nbsp;				case LONG:
<b class="nc">&nbsp;					return Long.valueOf(value);</b>
&nbsp;				case FLOAT:
<b class="nc">&nbsp;					return Float.valueOf(value);</b>
&nbsp;				case DOUBLE:
<b class="nc">&nbsp;					return Double.valueOf(value);</b>
&nbsp;				case BOOLEAN:
<b class="nc">&nbsp;					return Boolean.valueOf(value);</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				return value;</b>
&nbsp;			}
&nbsp;
&nbsp;			Object getDefaultValue() {
<b class="nc">&nbsp;				return getKeyValue(def);</b>
&nbsp;			}
&nbsp;		}
&nbsp;
<b class="nc">&nbsp;		class Data {</b>
&nbsp;			Key key;
&nbsp;			String id;
&nbsp;			String value;
&nbsp;		}
&nbsp;
&nbsp;		class Locator {
&nbsp;			String href;
&nbsp;			String xlink;
&nbsp;			String type;
&nbsp;
<b class="nc">&nbsp;			Locator() {</b>
<b class="nc">&nbsp;				xlink = &quot;http://www.w3.org/TR/2000/PR-xlink-20001220/&quot;;</b>
<b class="nc">&nbsp;				type = &quot;simple&quot;;</b>
<b class="nc">&nbsp;				href = null;</b>
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		class Port {
&nbsp;			String name;
&nbsp;			String desc;
&nbsp;
&nbsp;			LinkedList&lt;Data&gt; datas;
&nbsp;			LinkedList&lt;Port&gt; ports;
&nbsp;
<b class="nc">&nbsp;			Port() {</b>
<b class="nc">&nbsp;				name = null;</b>
<b class="nc">&nbsp;				desc = null;</b>
&nbsp;
<b class="nc">&nbsp;				datas = new LinkedList&lt;Data&gt;();</b>
<b class="nc">&nbsp;				ports = new LinkedList&lt;Port&gt;();</b>
&nbsp;			}
&nbsp;		}
&nbsp;
&nbsp;		class EndPoint {
&nbsp;			String id;
&nbsp;			String node;
&nbsp;			String port;
&nbsp;			String desc;
&nbsp;			EndPointType type;
&nbsp;
<b class="nc">&nbsp;			EndPoint() {</b>
<b class="nc">&nbsp;				id = null;</b>
<b class="nc">&nbsp;				node = null;</b>
<b class="nc">&nbsp;				port = null;</b>
<b class="nc">&nbsp;				desc = null;</b>
<b class="nc">&nbsp;				type = EndPointType.UNDIR;</b>
&nbsp;			}
&nbsp;		}
&nbsp;	}
&nbsp;
&nbsp;	protected GraphMLParser parser;
&nbsp;
&nbsp;	/**
&nbsp;	 * Build a new source to parse an xml stream in GraphML format.
&nbsp;	 */
<b class="nc">&nbsp;	public FileSourceGraphML() {</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	protected void afterStartDocument() throws IOException, XMLStreamException {
<b class="nc">&nbsp;		parser = new GraphMLParser();</b>
<b class="nc">&nbsp;		parser.__graphml();</b>
&nbsp;	}
&nbsp;
&nbsp;	@Override
&nbsp;	protected void beforeEndDocument() throws IOException, XMLStreamException {
<b class="nc">&nbsp;		parser = null;</b>
&nbsp;	}
&nbsp;
&nbsp;	/*
&nbsp;	 * (non-Javadoc)
&nbsp;	 *
&nbsp;	 * @see org.graphstream.stream.file.FileSource#nextEvents()
&nbsp;	 */
&nbsp;	public boolean nextEvents() throws IOException {
<b class="nc">&nbsp;		return false;</b>
&nbsp;	}
&nbsp;
<b class="nc">&nbsp;	protected class GraphMLParser extends Parser implements GraphMLConstants {</b>
&nbsp;		protected HashMap&lt;String, Key&gt; keys;
&nbsp;		protected Stack&lt;String&gt; graphId;
&nbsp;		protected int graphCounter;
&nbsp;
<b class="nc">&nbsp;		public GraphMLParser() {</b>
<b class="nc">&nbsp;			keys = new HashMap&lt;String, Key&gt;();</b>
<b class="nc">&nbsp;			graphId = new Stack&lt;String&gt;();</b>
<b class="nc">&nbsp;			graphCounter = 0;</b>
&nbsp;		}
&nbsp;
&nbsp;		private Object getValue(Data data) {
<b class="nc">&nbsp;			return getValue(data.key, data.value);</b>
&nbsp;		}
&nbsp;
&nbsp;		private Object getValue(Key key, String value) {
<b class="nc">&nbsp;			switch (key.type) {</b>
&nbsp;			case BOOLEAN:
<b class="nc">&nbsp;				return Boolean.parseBoolean(value);</b>
&nbsp;			case INT:
<b class="nc">&nbsp;				return Integer.parseInt(value);</b>
&nbsp;			case LONG:
<b class="nc">&nbsp;				return Long.parseLong(value);</b>
&nbsp;			case FLOAT:
<b class="nc">&nbsp;				return Float.parseFloat(value);</b>
&nbsp;			case DOUBLE:
<b class="nc">&nbsp;				return Double.parseDouble(value);</b>
&nbsp;			case STRING:
<b class="nc">&nbsp;				return value;</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			return value;</b>
&nbsp;		}
&nbsp;
&nbsp;		private Object getDefaultValue(Key key) {
<b class="nc">&nbsp;			switch (key.type) {</b>
&nbsp;			case BOOLEAN:
<b class="nc">&nbsp;				return Boolean.TRUE;</b>
&nbsp;			case INT:
<b class="nc">&nbsp;				if (key.def != null)</b>
<b class="nc">&nbsp;					return Integer.valueOf(key.def);</b>
&nbsp;
<b class="nc">&nbsp;				return Integer.valueOf(0);</b>
&nbsp;			case LONG:
<b class="nc">&nbsp;				if (key.def != null)</b>
<b class="nc">&nbsp;					return Long.valueOf(key.def);</b>
&nbsp;
<b class="nc">&nbsp;				return Long.valueOf(0);</b>
&nbsp;			case FLOAT:
<b class="nc">&nbsp;				if (key.def != null)</b>
<b class="nc">&nbsp;					return Float.valueOf(key.def);</b>
&nbsp;
<b class="nc">&nbsp;				return Float.valueOf(0.0f);</b>
&nbsp;			case DOUBLE:
<b class="nc">&nbsp;				if (key.def != null)</b>
<b class="nc">&nbsp;					return Double.valueOf(key.def);</b>
&nbsp;
<b class="nc">&nbsp;				return Double.valueOf(0.0);</b>
&nbsp;			case STRING:
<b class="nc">&nbsp;				if (key.def != null)</b>
<b class="nc">&nbsp;					return key.def;</b>
&nbsp;
<b class="nc">&nbsp;				return &quot;&quot;;</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			return key.def != null ? key.def : Boolean.TRUE;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT graphml  ((desc)?,(key)*,((data)|(graph))*)&gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private void __graphml() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;graphml&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__desc();</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			while (isEvent(e, XMLEvent.START_ELEMENT, &quot;key&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__key();</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			while (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;) || isEvent(e, XMLEvent.START_ELEMENT, &quot;graph&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
&nbsp;
<b class="nc">&nbsp;				if (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;)) {</b>
<b class="nc">&nbsp;					__data();</b>
&nbsp;				} else {
<b class="nc">&nbsp;					__graph();</b>
&nbsp;				}
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;graphml&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT desc (#PCDATA)&gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @return
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private String __desc() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;			String desc;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;desc&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			desc = __characters();</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;desc&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			return desc;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT locator EMPTY&gt;
&nbsp;		 * &lt;!ATTLIST locator
&nbsp;		 *           xmlns:xlink   CDATA    #FIXED    &quot;http://www.w3.org/TR/2000/PR-xlink-20001220/&quot;
&nbsp;		 *           xlink:href    CDATA    #REQUIRED
&nbsp;		 *           xlink:type    (simple) #FIXED    &quot;simple&quot;
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @return
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private Locator __locator() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;locator&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
&nbsp;
<b class="nc">&nbsp;			Locator loc = new Locator();</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					LocatorAttribute attribute = LocatorAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case XMLNS_XLINK:
<b class="nc">&nbsp;						loc.xlink = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case XLINK_HREF:
<b class="nc">&nbsp;						loc.href = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case XLINK_TYPE:
<b class="nc">&nbsp;						loc.type = a.getValue();</b>
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid locator attribute &#39;%s&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;locator&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			if (loc.href == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;locator requires an href&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			return loc;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT key (#PCDATA)&gt;
&nbsp;		 * &lt;!ATTLIST key
&nbsp;		 *           id  ID                                            #REQUIRED
&nbsp;		 *           for (graphml|graph|node|edge|hyperedge|port|endpoint|all) &quot;all&quot;
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private void __key() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;key&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
&nbsp;
<b class="nc">&nbsp;			String id = null;</b>
<b class="nc">&nbsp;			KeyDomain domain = KeyDomain.ALL;</b>
<b class="nc">&nbsp;			KeyAttrType type = KeyAttrType.STRING;</b>
<b class="nc">&nbsp;			String name = null;</b>
<b class="nc">&nbsp;			String def = null;</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					KeyAttribute attribute = KeyAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						id = a.getValue();</b>
&nbsp;
<b class="nc">&nbsp;						break;</b>
&nbsp;					case FOR:
&nbsp;						try {
<b class="nc">&nbsp;							domain = KeyDomain.valueOf(toConstantName(a.getValue()));</b>
<b class="nc">&nbsp;						} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;							newParseError(e, false, &quot;invalid key domain &#39;%s&#39;&quot;, a.getValue());</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						break;</b>
&nbsp;					case ATTR_TYPE:
&nbsp;						try {
<b class="nc">&nbsp;							type = KeyAttrType.valueOf(toConstantName(a.getValue()));</b>
<b class="nc">&nbsp;						} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;							newParseError(e, false, &quot;invalid key type &#39;%s&#39;&quot;, a.getValue());</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
<b class="nc">&nbsp;						break;</b>
&nbsp;					case ATTR_NAME:
<b class="nc">&nbsp;						name = a.getValue();</b>
&nbsp;
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid key attribute &#39;%s&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;default&quot;)) {</b>
<b class="nc">&nbsp;				def = __characters();</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
<b class="nc">&nbsp;				checkValid(e, XMLEvent.END_ELEMENT, &quot;default&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;key&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			if (id == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;key requires an id&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			if (name == null)</b>
<b class="nc">&nbsp;				name = id;</b>
&nbsp;
<b class="nc">&nbsp;			Key k = new Key();</b>
<b class="nc">&nbsp;			k.name = name;</b>
<b class="nc">&nbsp;			k.domain = domain;</b>
<b class="nc">&nbsp;			k.type = type;</b>
<b class="nc">&nbsp;			k.def = def;</b>
&nbsp;
<b class="nc">&nbsp;			keys.put(id, k);</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT port ((desc)?,((data)|(port))*)&gt;
&nbsp;		 * &lt;!ATTLIST port
&nbsp;		 *           name    NMTOKEN  #REQUIRED
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @return
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private Port __port() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;port&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			Port port = new Port();</b>
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					PortAttribute attribute = PortAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case NAME:
<b class="nc">&nbsp;						port.name = a.getValue();</b>
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid attribute &#39;%s&#39; for &#39;&lt;port&gt;&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (port.name == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;&#39;&lt;port&gt;&#39; element requires a &#39;name&#39; attribute&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				port.desc = __desc();</b>
&nbsp;			} else {
<b class="nc">&nbsp;				while (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;) || isEvent(e, XMLEvent.START_ELEMENT, &quot;port&quot;)) {</b>
<b class="nc">&nbsp;					if (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;)) {</b>
&nbsp;						Data data;
&nbsp;
<b class="nc">&nbsp;						pushback(e);</b>
<b class="nc">&nbsp;						data = __data();</b>
&nbsp;
<b class="nc">&nbsp;						port.datas.add(data);</b>
<b class="nc">&nbsp;					} else {</b>
&nbsp;						Port portChild;
&nbsp;
<b class="nc">&nbsp;						pushback(e);</b>
<b class="nc">&nbsp;						portChild = __port();</b>
&nbsp;
<b class="nc">&nbsp;						port.ports.add(portChild);</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					e = getNextEvent();</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;port&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			return port;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT endpoint ((desc)?)&gt;
&nbsp;		 * &lt;!ATTLIST endpoint
&nbsp;		 *           id    ID             #IMPLIED
&nbsp;		 *           node  IDREF          #REQUIRED
&nbsp;		 *           port  NMTOKEN        #IMPLIED
&nbsp;		 *           type  (in|out|undir) &quot;undir&quot;
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @return
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private EndPoint __endpoint() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;endpoint&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
<b class="nc">&nbsp;			EndPoint ep = new EndPoint();</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					EndPointAttribute attribute = EndPointAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case NODE:
<b class="nc">&nbsp;						ep.node = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						ep.id = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case PORT:
<b class="nc">&nbsp;						ep.port = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case TYPE:
&nbsp;						try {
<b class="nc">&nbsp;							ep.type = EndPointType.valueOf(toConstantName(a.getValue()));</b>
<b class="nc">&nbsp;						} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;							newParseError(e, false, &quot;invalid end point type &#39;%s&#39;&quot;, a.getValue());</b>
<b class="nc">&nbsp;						}</b>
&nbsp;
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid attribute &#39;%s&#39; for &#39;&lt;endpoint&gt;&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (ep.node == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;&#39;&lt;endpoint&gt;&#39; element requires a &#39;node&#39; attribute&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				ep.desc = __desc();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;endpoint&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			return ep;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT data  (#PCDATA)&gt;
&nbsp;		 * &lt;!ATTLIST data
&nbsp;		 *           key      IDREF        #REQUIRED
&nbsp;		 *           id       ID           #IMPLIED
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @return
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private Data __data() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;data&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
<b class="nc">&nbsp;			String key = null, id = null, value;</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					DataAttribute attribute = DataAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case KEY:
<b class="nc">&nbsp;						key = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						id = a.getValue();</b>
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid attribute &#39;%s&#39; for &#39;&lt;data&gt;&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (key == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;&#39;&lt;data&gt;&#39; element must have a &#39;key&#39; attribute&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			value = __characters();</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;data&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			if (!keys.containsKey(key))</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;unknown key &#39;%s&#39;&quot;, key);</b>
&nbsp;
<b class="nc">&nbsp;			Data d = new Data();</b>
&nbsp;
<b class="nc">&nbsp;			d.key = keys.get(key);</b>
<b class="nc">&nbsp;			d.id = id;</b>
<b class="nc">&nbsp;			d.value = value;</b>
&nbsp;
<b class="nc">&nbsp;			return d;</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT graph    ((desc)?,((((data)|(node)|(edge)|(hyperedge))*)|(locator)))&gt;
&nbsp;		 * &lt;!ATTLIST graph
&nbsp;		 *     id          ID                    #IMPLIED
&nbsp;		 *     edgedefault (directed|undirected) #REQUIRED
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private void __graph() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;graph&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
&nbsp;
<b class="nc">&nbsp;			String id = null;</b>
<b class="nc">&nbsp;			String desc = null;</b>
<b class="nc">&nbsp;			boolean directed = false;</b>
<b class="nc">&nbsp;			boolean directedSet = false;</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					GraphAttribute attribute = GraphAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						id = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case EDGEDEFAULT:
<b class="nc">&nbsp;						if (a.getValue().equals(&quot;directed&quot;))</b>
<b class="nc">&nbsp;							directed = true;</b>
<b class="nc">&nbsp;						else if (a.getValue().equals(&quot;undirected&quot;))</b>
<b class="nc">&nbsp;							directed = false;</b>
&nbsp;						else
<b class="nc">&nbsp;							newParseError(e, true, &quot;invalid &#39;edgedefault&#39; value &#39;%s&#39;&quot;, a.getValue());</b>
&nbsp;
<b class="nc">&nbsp;						directedSet = true;</b>
&nbsp;
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid node attribute &#39;%s&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (!directedSet)</b>
<b class="nc">&nbsp;				newParseError(e, false, &quot;graph requires attribute &#39;edgedefault&#39;&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			String gid = &quot;&quot;;</b>
&nbsp;
<b class="nc">&nbsp;			if (graphId.size() &gt; 0)</b>
<b class="nc">&nbsp;				gid = graphId.peek() + &quot;:&quot;;</b>
&nbsp;
<b class="nc">&nbsp;			if (id != null)</b>
<b class="nc">&nbsp;				gid += id;</b>
&nbsp;			else
<b class="nc">&nbsp;				gid += Integer.toString(graphCounter++);</b>
&nbsp;
<b class="nc">&nbsp;			graphId.push(gid);</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				desc = __desc();</b>
&nbsp;
<b class="nc">&nbsp;				sendGraphAttributeAdded(sourceId, &quot;desc&quot;, desc);</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;locator&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__locator();</b>
&nbsp;				// TODO
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			} else {
<b class="nc">&nbsp;				while (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;) || isEvent(e, XMLEvent.START_ELEMENT, &quot;node&quot;)</b>
<b class="nc">&nbsp;						|| isEvent(e, XMLEvent.START_ELEMENT, &quot;edge&quot;)</b>
<b class="nc">&nbsp;						|| isEvent(e, XMLEvent.START_ELEMENT, &quot;hyperedge&quot;)) {</b>
<b class="nc">&nbsp;					pushback(e);</b>
&nbsp;
<b class="nc">&nbsp;					if (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;)) {</b>
<b class="nc">&nbsp;						Data data = __data();</b>
<b class="nc">&nbsp;						sendGraphAttributeAdded(sourceId, data.key.name, getValue(data));</b>
<b class="nc">&nbsp;					} else if (isEvent(e, XMLEvent.START_ELEMENT, &quot;node&quot;)) {</b>
<b class="nc">&nbsp;						__node();</b>
<b class="nc">&nbsp;					} else if (isEvent(e, XMLEvent.START_ELEMENT, &quot;edge&quot;)) {</b>
<b class="nc">&nbsp;						__edge(directed);</b>
&nbsp;					} else {
<b class="nc">&nbsp;						__hyperedge();</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					e = getNextEvent();</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			graphId.pop();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;graph&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT node   (desc?,(((data|port)*,graph?)|locator))&gt;
&nbsp;		 * &lt;!ATTLIST node
&nbsp;		 *     		 id        ID      #REQUIRED
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private void __node() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;node&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
&nbsp;
<b class="nc">&nbsp;			String id = null;</b>
<b class="nc">&nbsp;			HashSet&lt;Key&gt; sentAttributes = new HashSet&lt;Key&gt;();</b>
<b class="nc">&nbsp;			HashSet&lt;Attribute&gt; unexpectedAttributes = new HashSet&lt;&gt;();</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					NodeAttribute attribute = NodeAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						id = a.getValue();</b>
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					if (strictMode)</b>
<b class="nc">&nbsp;						newParseError(e, false, &quot;invalid node attribute &#39;%s&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;					unexpectedAttributes.add(a);</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (id == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;node requires an id&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			sendNodeAdded(sourceId, id);</b>
&nbsp;
<b class="nc">&nbsp;			if (!strictMode &amp;&amp; unexpectedAttributes.size() &gt; 0) {</b>
<b class="nc">&nbsp;				for (Attribute a : unexpectedAttributes) {</b>
<b class="nc">&nbsp;					String name = a.getName().getLocalPart();</b>
<b class="nc">&nbsp;					Key key = keys.get(name);</b>
<b class="nc">&nbsp;					Object value = key == null ? a.getValue() : getValue(key, a.getValue());</b>
&nbsp;
<b class="nc">&nbsp;					sendNodeAttributeAdded(sourceId, id, name, value);</b>
&nbsp;
<b class="nc">&nbsp;					if (key != null)</b>
<b class="nc">&nbsp;						sentAttributes.add(key);</b>
<b class="nc">&nbsp;				}</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
&nbsp;				String desc;
&nbsp;
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				desc = __desc();</b>
&nbsp;
<b class="nc">&nbsp;				sendNodeAttributeAdded(sourceId, id, &quot;desc&quot;, desc);</b>
<b class="nc">&nbsp;			} else if (isEvent(e, XMLEvent.START_ELEMENT, &quot;locator&quot;)) {</b>
&nbsp;				// TODO
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__locator();</b>
&nbsp;			} else {
<b class="nc">&nbsp;				while (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;) || isEvent(e, XMLEvent.START_ELEMENT, &quot;port&quot;)) {</b>
<b class="nc">&nbsp;					if (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;)) {</b>
&nbsp;						Data data;
&nbsp;
<b class="nc">&nbsp;						pushback(e);</b>
<b class="nc">&nbsp;						data = __data();</b>
&nbsp;
<b class="nc">&nbsp;						sendNodeAttributeAdded(sourceId, id, data.key.name, getValue(data));</b>
&nbsp;
<b class="nc">&nbsp;						sentAttributes.add(data.key);</b>
<b class="nc">&nbsp;					} else {</b>
<b class="nc">&nbsp;						pushback(e);</b>
<b class="nc">&nbsp;						__port();</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					e = getNextEvent();</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			for (Key k : keys.values()) {</b>
<b class="nc">&nbsp;				if ((k.domain == KeyDomain.NODE || k.domain == KeyDomain.ALL) &amp;&amp; !sentAttributes.contains(k))</b>
<b class="nc">&nbsp;					sendNodeAttributeAdded(sourceId, id, k.name, getDefaultValue(k));</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;graph&quot;)) {</b>
<b class="nc">&nbsp;				Location loc = e.getLocation();</b>
&nbsp;
<b class="nc">&nbsp;				System.err.printf(&quot;[WARNING] %d:%d graph inside node is not implemented&quot;, loc.getLineNumber(),</b>
<b class="nc">&nbsp;						loc.getColumnNumber());</b>
&nbsp;
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__graph();</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;node&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT edge ((desc)?,(data)*,(graph)?)&gt;
&nbsp;		 * &lt;!ATTLIST edge
&nbsp;		 *           id         ID           #IMPLIED
&nbsp;		 *           source     IDREF        #REQUIRED
&nbsp;		 *           sourceport NMTOKEN      #IMPLIED
&nbsp;		 *           target     IDREF        #REQUIRED
&nbsp;		 *           targetport NMTOKEN      #IMPLIED
&nbsp;		 *           directed   (true|false) #IMPLIED
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @param edgedefault
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private void __edge(boolean edgedefault) throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;edge&quot;);</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
&nbsp;
<b class="nc">&nbsp;			HashSet&lt;Key&gt; sentAttributes = new HashSet&lt;Key&gt;();</b>
<b class="nc">&nbsp;			HashSet&lt;Attribute&gt; unexpectedAttributes = new HashSet&lt;&gt;();</b>
<b class="nc">&nbsp;			String id = null;</b>
<b class="nc">&nbsp;			boolean directed = edgedefault;</b>
<b class="nc">&nbsp;			String source = null;</b>
<b class="nc">&nbsp;			String target = null;</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					EdgeAttribute attribute = EdgeAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						id = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case DIRECTED:
<b class="nc">&nbsp;						directed = Boolean.parseBoolean(a.getValue());</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case SOURCE:
<b class="nc">&nbsp;						source = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case TARGET:
<b class="nc">&nbsp;						target = a.getValue();</b>
<b class="nc">&nbsp;						break;</b>
&nbsp;					case SOURCEPORT:
&nbsp;					case TARGETPORT:
<b class="nc">&nbsp;						newParseError(e, false, &quot;sourceport and targetport not implemented&quot;);</b>
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					if (strictMode)</b>
<b class="nc">&nbsp;						newParseError(e, false, &quot;invalid graph attribute &#39;%s&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;					unexpectedAttributes.add(a);</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (source == null || target == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;edge must have a source and a target&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			if (id == null) {</b>
<b class="nc">&nbsp;				id = String.format(&quot;%s--%s&quot;, source, target);</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			sendEdgeAdded(sourceId, id, source, target, directed);</b>
&nbsp;
<b class="nc">&nbsp;			if (!strictMode &amp;&amp; unexpectedAttributes.size() &gt; 0) {</b>
<b class="nc">&nbsp;				for (Attribute a : unexpectedAttributes) {</b>
<b class="nc">&nbsp;					String name = a.getName().getLocalPart();</b>
<b class="nc">&nbsp;					Key key = keys.get(name);</b>
<b class="nc">&nbsp;					Object value = key == null ? a.getValue() : getValue(key, a.getValue());</b>
&nbsp;
<b class="nc">&nbsp;					sendEdgeAttributeAdded(sourceId, id, name, value);</b>
&nbsp;
<b class="nc">&nbsp;					if (key != null)</b>
<b class="nc">&nbsp;						sentAttributes.add(key);</b>
<b class="nc">&nbsp;				}</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
&nbsp;				String desc;
&nbsp;
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				desc = __desc();</b>
&nbsp;
<b class="nc">&nbsp;				sendEdgeAttributeAdded(sourceId, id, &quot;desc&quot;, desc);</b>
<b class="nc">&nbsp;			} else {</b>
<b class="nc">&nbsp;				while (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;)) {</b>
&nbsp;					Data data;
&nbsp;
<b class="nc">&nbsp;					pushback(e);</b>
<b class="nc">&nbsp;					data = __data();</b>
&nbsp;
<b class="nc">&nbsp;					sendEdgeAttributeAdded(sourceId, id, data.key.name, getValue(data));</b>
&nbsp;
<b class="nc">&nbsp;					sentAttributes.add(data.key);</b>
&nbsp;
<b class="nc">&nbsp;					e = getNextEvent();</b>
<b class="nc">&nbsp;				}</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			for (Key k : keys.values()) {</b>
<b class="nc">&nbsp;				if ((k.domain == KeyDomain.EDGE || k.domain == KeyDomain.ALL) &amp;&amp; !sentAttributes.contains(k))</b>
<b class="nc">&nbsp;					sendEdgeAttributeAdded(sourceId, id, k.name, getDefaultValue(k));</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;graph&quot;)) {</b>
<b class="nc">&nbsp;				newParseError(e, false, &quot;graph inside node is not implemented&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__graph();</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;edge&quot;);</b>
&nbsp;		}
&nbsp;
&nbsp;		/**
&nbsp;		 * &lt;pre&gt;
&nbsp;		 * &lt;!ELEMENT hyperedge  ((desc)?,((data)|(endpoint))*,(graph)?)&gt;
&nbsp;		 * &lt;!ATTLIST hyperedge
&nbsp;		 *           id     ID      #IMPLIED
&nbsp;		 * &gt;
&nbsp;		 * &lt;/pre&gt;
&nbsp;		 *
&nbsp;		 * @throws IOException
&nbsp;		 * @throws XMLStreamException
&nbsp;		 */
&nbsp;		private void __hyperedge() throws IOException, XMLStreamException {
&nbsp;			XMLEvent e;
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.START_ELEMENT, &quot;hyperedge&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			newParseError(e, false, &quot;hyperedge feature is not implemented&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			String id = null;</b>
&nbsp;
&nbsp;			@SuppressWarnings(&quot;unchecked&quot;)
<b class="nc">&nbsp;			Iterator&lt;? extends Attribute&gt; attributes = e.asStartElement().getAttributes();</b>
&nbsp;
<b class="nc">&nbsp;			while (attributes.hasNext()) {</b>
<b class="nc">&nbsp;				Attribute a = attributes.next();</b>
&nbsp;
&nbsp;				try {
<b class="nc">&nbsp;					HyperEdgeAttribute attribute = HyperEdgeAttribute.valueOf(toConstantName(a));</b>
&nbsp;
<b class="nc">&nbsp;					switch (attribute) {</b>
&nbsp;					case ID:
<b class="nc">&nbsp;						id = a.getValue();</b>
&nbsp;						break;
&nbsp;					}
<b class="nc">&nbsp;				} catch (IllegalArgumentException ex) {</b>
<b class="nc">&nbsp;					newParseError(e, false, &quot;invalid attribute &#39;%s&#39; for &#39;&lt;endpoint&gt;&#39;&quot;, a.getName().getLocalPart());</b>
<b class="nc">&nbsp;				}</b>
<b class="nc">&nbsp;			}</b>
&nbsp;
<b class="nc">&nbsp;			if (id == null)</b>
<b class="nc">&nbsp;				newParseError(e, true, &quot;&#39;&lt;hyperedge&gt;&#39; element requires a &#39;node&#39; attribute&quot;);</b>
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;desc&quot;)) {</b>
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__desc();</b>
&nbsp;			} else {
<b class="nc">&nbsp;				while (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;) || isEvent(e, XMLEvent.START_ELEMENT, &quot;endpoint&quot;)) {</b>
<b class="nc">&nbsp;					if (isEvent(e, XMLEvent.START_ELEMENT, &quot;data&quot;)) {</b>
<b class="nc">&nbsp;						pushback(e);</b>
<b class="nc">&nbsp;						__data();</b>
&nbsp;					} else {
<b class="nc">&nbsp;						pushback(e);</b>
<b class="nc">&nbsp;						__endpoint();</b>
&nbsp;					}
&nbsp;
<b class="nc">&nbsp;					e = getNextEvent();</b>
&nbsp;				}
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			if (isEvent(e, XMLEvent.START_ELEMENT, &quot;graph&quot;)) {</b>
<b class="nc">&nbsp;				newParseError(e, false, &quot;graph inside node is not implemented&quot;);</b>
&nbsp;
<b class="nc">&nbsp;				pushback(e);</b>
<b class="nc">&nbsp;				__graph();</b>
&nbsp;
<b class="nc">&nbsp;				e = getNextEvent();</b>
&nbsp;			}
&nbsp;
<b class="nc">&nbsp;			e = getNextEvent();</b>
<b class="nc">&nbsp;			checkValid(e, XMLEvent.END_ELEMENT, &quot;hyperedge&quot;);</b>
&nbsp;		}
&nbsp;	}
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-07-08 16:57</div>
</div>
</body>
</html>
